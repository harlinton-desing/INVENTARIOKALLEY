<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Inventario Gamer App - Optimizado</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
body {
  background: linear-gradient(135deg, #0a0f1c, #1a1a2e);
  color: #fff;
  font-family: "Segoe UI", sans-serif;
  margin: 0;
  padding: 0;
}
.nav-link {
  color: #003cff !important;
  font-weight: 500;
}
.nav-link.active {
  color: #00d9ff !important;
}
.card {
  background: rgba(17, 26, 43, 0.9);
  border-radius: 12px;
  transition: all 0.3s;
  border: 1px solid #00d9ff55;
}
.card:hover {
  box-shadow: 0 0 20px #00d9ff;
  transform: translateY(-5px);
}
h1, h2, h3, h4, h5 {
  color: #00d9ff;
}
input, select, textarea {
  background: #0f1628 !important;
  color: #fff !important;
  border: 1px solid #00d9ff55;
  border-radius: 8px;
}
input:focus, select:focus, textarea:focus {
  border-color: #00d9ff;
  box-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
}
::placeholder {
  color: #fff !important;
  opacity: 0.8;
}
table {
  color: #fff;
  background: rgba(17, 26, 43, 0.9);
}
table tbody tr:hover {
  background: #001133;
}
.btn-info {
  background: linear-gradient(90deg, #00d9ff, #6f00ff);
  border: none;
  transition: all 0.3s;
}
.btn-info:hover {
  transform: scale(1.05);
  box-shadow: 0 0 15px rgba(0, 217, 255, 0.7);
}
.btn-eliminar {
  background: #ff0033;
  color: #fff;
  border: none;
  transition: all 0.3s;
}
.btn-eliminar:hover {
  background: #cc0022;
  transform: scale(1.05);
}
.logo {
  width: 60px;
  margin-right: 10px;
}
.header-app {
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 15px;
  flex-wrap: wrap;
  padding: 10px;
}
.card-azul {
  background: linear-gradient(135deg, #0044ff, #0a0a0a);
}
.card-violeta {
  background: linear-gradient(135deg, #6f00ff, #030303);
}
.card-verde {
  background: linear-gradient(135deg, #009933, #070707);
}
.card-rojo {
  background: linear-gradient(135deg, #ff0033, #070707);
}
.modal-fullscreen {
  background: #0a0f1c;
}
.menu-hamburguesa {
  font-size: 1.8rem;
  color: #00d9ff;
  cursor: pointer;
  display: none;
  transition: all 0.3s;
  padding: 5px 10px;
  border-radius: 5px;
  margin-left: 10px;
  border: none;
  background: none;
}
.menu-hamburguesa:hover {
  background: rgba(0, 217, 255, 0.1);
  transform: scale(1.1);
}
canvas {
  min-height: 200px;
  max-width: 100%;
  border-radius: 10px;
}
.chart-container {
  position: relative;
  margin: auto;
  height: 300px;
  width: 100%;
}
.table-professional {
  border-collapse: separate;
  border-spacing: 0;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}
.table-professional th {
  background: #00d9ff;
  color: #000;
  font-weight: bold;
  padding: 12px;
  text-align: center;
}
.table-professional td {
  padding: 10px;
  text-align: center;
  border-bottom: 1px solid #00d9ff55;
}
.table-professional tbody tr:hover {
  background: #001133;
}
@media (max-width: 767px) {
  .nav-tabs {
    display: none !important;
  }
  .nav-tabs.show {
    display: flex !important;
    flex-direction: column;
    background: rgba(17, 26, 43, 0.95);
    backdrop-filter: blur(10px);
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    z-index: 1000;
    border-radius: 0 0 10px 10px;
    border: 1px solid #00d9ff55;
    border-top: none;
    box-shadow: 0 4px 20px rgba(0, 217, 255, 0.3);
  }
  .nav-tabs.show .nav-item {
    margin: 0;
    border-bottom: 1px solid #00d9ff33;
  }
  .nav-tabs.show .nav-item:last-child {
    border-bottom: none;
  }
  .nav-tabs.show .nav-link {
    padding: 15px 20px;
    color: #00d9ff !important;
    text-align: center;
    font-weight: 500;
    transition: all 0.3s;
  }
  .nav-tabs.show .nav-link:hover {
    background: rgba(0, 217, 255, 0.1);
    color: #fff !important;
  }
  .menu-hamburguesa {
    display: block !important;
    position: relative;
    z-index: 1001;
  }
  .header-app {
    flex-direction: column;
    text-align: center;
    position: relative;
  }
  .card {
    margin-bottom: 15px;
  }
  .btn {
    width: 100%;
    margin-bottom: 10px;
  }
}
.toast {
  background: rgba(17, 26, 43, 0.9);
  color: #fff;
  border: 1px solid #00d9ff;
}
</style>
</head>
<body>

<!-- Modal Bienvenida -->
<div class="modal fade" id="modalBienvenida" tabindex="-1" aria-labelledby="modalBienvenidaLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-fullscreen">
    <div class="modal-content d-flex flex-column align-items-center justify-content-center text-center" style="background:#0a0f1c; color:#fff;">
      <h1 class="mb-4" style="color:#00d9ff;">¡Bienvenido Harlinton!</h1>
      <img src="imagen/logo.png" alt="Bienvenido" class="img-fluid mb-4" style="max-width:250px; width:80%; height:auto;">
      <p style="font-size:1.2rem;">Prepárate para gestionar tu inventario gamer de manera eficiente.</p>
      <button type="button" class="btn btn-info btn-lg mt-4" data-bs-dismiss="modal">Ingresar</button>
    </div>
  </div>
</div>

<div class="container-fluid py-3">
  <!-- Header -->
  <div class="header-app">
    <img src="imagen/logo.png" class="logo" alt="Logo">
    <h3>Inventario KALLEY</h3>
    <button class="menu-hamburguesa ms-3" onclick="toggleMenu()" onkeydown="handleMenuKey(event)" aria-expanded="false" aria-controls="tabsMenu">☰</button>
  </div>

  <!-- Menú -->
  <ul class="nav nav-tabs justify-content-center" id="tabsMenu" role="navigation">
    <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#dashboard" onclick="closeMenuOnMobile()">Dashboard</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#clientes" onclick="closeMenuOnMobile()">Clientes</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#inventario" onclick="closeMenuOnMobile()">Inventario</a></li>
  </ul>

  <div class="tab-content mt-3">
    <!-- DASHBOARD -->
    <div class="tab-pane fade show active" id="dashboard">
      <div class="row g-3 mb-3">
        <div class="col-12 col-sm-6 col-md-3">
          <div class="card p-3 text-center card-azul">
            <h6>Total vendido</h6>
            <h4 id="totalVendido" style="color:#00ffea;font-weight:bold;">$0</h4>
          </div>
        </div>
        <div class="col-12 col-sm-6 col-md-3">
          <div class="card p-3 text-center card-violeta">
            <h6>Meta (COP)</h6>
            <input type="number" id="metaInput" class="form-control text-center mb-2 w-100" placeholder="Meta mensual" min="0">
            <button class="btn btn-light btn-sm w-100" onclick="guardarMeta()">Guardar</button>
          </div>
        </div>
        <div class="col-12 col-sm-6 col-md-3">
          <div class="card p-3 text-center card-verde">
            <h6>Cumplimiento</h6>
            <h4 id="cumplimiento" style="color:#00ff66;font-weight:bold;">0%</h4>
          </div>
        </div>
        <div class="col-12 col-sm-6 col-md-3">
          <div class="card p-3 text-center card-rojo">
            <h6>Faltante</h6>
            <h4 id="faltante" style="color:#ff4444;font-weight:bold;">$0</h4>
          </div>
        </div>
      </div>

      <div class="mb-3 d-flex flex-wrap gap-2 justify-content-center">
        <button class="btn btn-info btn-sm" onclick="exportPDFInventario()">PDF Inventario</button>
        <button class="btn btn-info btn-sm" onclick="exportarClientesExcel()">Exportar Clientes</button>
        <button class="btn btn-info btn-sm" onclick="resetDashboard()">Reset Dashboard</button>
      </div>

      <div class="row g-3">
        <div class="col-12 col-md-6">
          <div class="card p-3">
            <h5>Ventas por Día</h5>
            <div class="chart-container">
              <canvas id="ventasDia"></canvas>
            </div>
          </div>
        </div>
        <div class="col-12 col-md-6">
          <div class="card p-3">
            <h5>Ventas por Producto</h5>
            <div class="chart-container">
              <canvas id="ventasProducto"></canvas>
            </div>
          </div>
        </div>
        <div class="col-12">
          <div class="card p-3">
            <h5>Cumplimiento</h5>
            <div class="chart-container">
              <canvas id="cumplimientoChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="card p-3 mt-4">
        <h5>Ventas por equipo</h5>
        <select id="filtroEquipo" class="form-control mb-2 w-100" onchange="filtrarVentasEquipo()">
          <option value="todos">Todos</option>
          <option value="dia">Hoy</option>
          <option value="semana">Esta semana</option>
          <option value="mes">Este mes</option>
          <option value="anio">Este año</option>
        </select>
        <div class="table-responsive mt-3">
          <table class="table table-professional" id="tablaVentasEquipo">
            <thead><tr><th>Imagen</th><th>Referencia</th><th>Cantidad vendida</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="chart-container mt-3">
          <canvas id="ventasEquipo"></canvas>
        </div>
      </div>
    </div>

    <!-- CLIENTES -->
    <div class="tab-pane fade" id="clientes">
      <div class="mb-3">
        <button class="btn btn-info w-100" onclick="toggleNuevaVenta()">Nueva Venta</button>
      </div>
      <div id="formNuevaVenta" style="display:none;">
        <div class="card p-3 mb-3">
          <h5>Registrar Venta</h5>
          <input type="text" id="ventaCliente" class="form-control mb-2 w-100" placeholder="Nombre del cliente" required>
          <input type="text" id="ventaCelular" class="form-control mb-2 w-100" placeholder="Celular" required>
          <select id="ventaProducto" class="form-control mb-2 w-100" required>
            <option value="">Seleccionar Equipo</option>
          </select>
          <input type="number" id="ventaPrecio" class="form-control mb-2 w-100" placeholder="Precio" min="0" required>
          <input type="number" id="ventaCantidad" class="form-control mb-2 w-100" placeholder="Cantidad" min="1" required>
          <button class="btn btn-info w-100 mb-2" onclick="registrarVenta()">Registrar Venta</button>
          <button class="btn btn-light w-100" onclick="agregarOtroProducto()">Agregar Otro Producto</button>
        </div>
      </div>
      <div class="table-responsive">
        <table class="table table-dark table-striped">
          <thead><tr><th>Nombre</th><th>Celular</th><th>Producto</th><th>Foto</th><th>Fecha/Hora</th><th>Acción</th></tr></thead>
          <tbody id="tablaClientes"></tbody>
        </table>
      </div>
    </div>

    <!-- INVENTARIO -->
    <div class="tab-pane fade" id="inventario">
      <div class="card p-3 mb-3">
        <h5>Agregar nuevo producto</h5>
        <input type="text" id="productoNombre" class="form-control mb-2 w-100" placeholder="Nombre del producto" required>
        <input type="text" id="productoCodigo" class="form-control mb-2 w-100" placeholder="Código del material" required>
        <input type="number" id="productoCantidad" class="form-control mb-2 w-100" placeholder="Cantidad (mínimo 0)" min="0" required>
        <input type="file" id="productoFoto" class="form-control mb-2 w-100" accept="image/*" required>
        <button class="btn btn-info w-100" onclick="agregarProducto()">Agregar</button>
      </div>
      <div class="card p-3 mb-3">
        <h5>Agregar cantidad a producto existente</h5>
        <select id="productoExistente" class="form-control mb-2 w-100" required>
          <option value="">Seleccione producto</option>
        </select>
        <input type="number" id="cantidadExtra" class="form-control mb-2 w-100" placeholder="Cantidad a agregar" min="1" required>
        <button class="btn btn-info w-100" onclick="agregarCantidadExistente()">Agregar cantidad</button>
      </div>
      <div class="table-responsive">
        <table class="table table-dark table-striped">
          <thead><tr><th>Foto</th><th>Producto</th><th>Código</th><th>Cantidad</th><th>Acción</th></tr></thead>
          <tbody id="tablaInventario"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Toast for notifications -->
<div class="toast-container position-fixed top-0 end-0 p-3">
  <div id="notificationToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
      <strong class="me-auto">Notificación</strong>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body" id="toastMessage">Acción completada.</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Variables globales
let inventario = JSON.parse(localStorage.getItem("inventario")) || [];
let ventas = JSON.parse(localStorage.getItem("ventas")) || [];
let clientes = JSON.parse(localStorage.getItem("clientes")) || [];
let meta = parseInt(localStorage.getItem("meta")) || 0;

let chartVentasDia, chartVentasProducto, chartCumplimiento, chartVentasEquipo;

// Inicialización
document.addEventListener('DOMContentLoaded', () => {
  const modal = new bootstrap.Modal(document.getElementById('modalBienvenida'));
  modal.show();
  mostrarInventario();
  cargarProductosVenta();
  mostrarClientes();
  actualizarDashboard();
});

// Funciones de UI
function toggleMenu() {
  const menu = document.getElementById("tabsMenu");
  const hamburger = document.querySelector(".menu-hamburguesa");

  menu.classList.toggle("show");

  // Update aria-expanded
  const isExpanded = menu.classList.contains("show");
  hamburger.setAttribute("aria-expanded", isExpanded);

  // Visual feedback for hamburger button
  if (isExpanded) {
    hamburger.style.background = "rgba(0, 217, 255, 0.2)";
    hamburger.style.transform = "scale(1.1)";
  } else {
    hamburger.style.background = "";
    hamburger.style.transform = "";
  }
}

function handleMenuKey(event) {
  if (event.key === "Enter" || event.key === " ") {
    event.preventDefault();
    toggleMenu();
  }
}

function closeMenuOnMobile() {
  if (window.innerWidth <= 767) {
    const menu = document.getElementById("tabsMenu");
    menu.classList.remove("show");
    const hamburger = document.querySelector(".menu-hamburguesa");
    hamburger.setAttribute("aria-expanded", "false");
  }
}

function showToast(message) {
  document.getElementById('toastMessage').textContent = message;
  const toast = new bootstrap.Toast(document.getElementById('notificationToast'));
  toast.show();
}

// Inventario
function agregarProducto() {
  const nombre = document.getElementById("productoNombre").value.trim();
  const codigo = document.getElementById("productoCodigo").value.trim();
  const cantidad = parseInt(document.getElementById("productoCantidad").value) || 0;
  const fotoInput = document.getElementById("productoFoto");
  const foto = fotoInput.files[0];

  if (!nombre || !codigo || !foto) {
    showToast("Todos los campos son obligatorios.");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    inventario.push({ nombre, codigo, cantidad, foto: e.target.result });
    localStorage.setItem("inventario", JSON.stringify(inventario));
    mostrarInventario();
    cargarProductosVenta();
    // Limpiar formulario
    document.getElementById("productoNombre").value = "";
    document.getElementById("productoCodigo").value = "";
    document.getElementById("productoCantidad").value = "";
    fotoInput.value = "";
    showToast("Producto agregado exitosamente.");
  };
  reader.readAsDataURL(foto);
}

function agregarCantidadExistente() {
  const idx = parseInt(document.getElementById("productoExistente").value);
  const cantidad = parseInt(document.getElementById("cantidadExtra").value);

  if (isNaN(idx) || isNaN(cantidad) || cantidad < 1) {
    showToast("Selecciona producto y cantidad válida.");
    return;
  }

  inventario[idx].cantidad += cantidad;
  localStorage.setItem("inventario", JSON.stringify(inventario));
  mostrarInventario();
  cargarProductosVenta();
  document.getElementById("cantidadExtra").value = "";
  showToast("Cantidad agregada exitosamente.");
}

function mostrarInventario() {
  const tabla = document.getElementById("tablaInventario");
  tabla.innerHTML = "";
  const selectExistente = document.getElementById("productoExistente");
  selectExistente.innerHTML = '<option value="">Seleccione producto</option>';

  inventario.forEach((p, i) => {
    tabla.innerHTML += `<tr>
      <td><img src="${p.foto}" width="40" alt="${p.nombre}"></td>
      <td>${p.nombre}</td>
      <td>${p.codigo}</td>
      <td>${p.cantidad}</td>
      <td><button class="btn btn-eliminar btn-sm" onclick="eliminarProducto(${i})">Eliminar</button></td>
    </tr>`;
    selectExistente.innerHTML += `<option value="${i}">${p.nombre} (Stock: ${p.cantidad})</option>`;
  });
}

function eliminarProducto(i) {
  if (confirm("¿Estás seguro de eliminar este producto?")) {
    inventario.splice(i, 1);
    localStorage.setItem("inventario", JSON.stringify(inventario));
    mostrarInventario();
    cargarProductosVenta();
    showToast("Producto eliminado.");
  }
}

// Ventas
function toggleNuevaVenta() {
  const form = document.getElementById("formNuevaVenta");
  form.style.display = form.style.display === "none" ? "block" : "none";
}

function agregarOtroProducto() {
  document.getElementById("ventaProducto").value = "";
  document.getElementById("ventaPrecio").value = "";
  document.getElementById("ventaCantidad").value = "";
}

function cargarProductosVenta() {
  const select = document.getElementById("ventaProducto");
  select.innerHTML = '<option value="">Seleccionar Equipo</option>';
  inventario.forEach((p, i) => {
    if (p.cantidad > 0) {
      select.innerHTML += `<option value="${i}">${p.nombre} (Disponible: ${p.cantidad})</option>`;
    }
  });
}

function registrarVenta() {
  const cliente = document.getElementById("ventaCliente").value.trim();
  const celular = document.getElementById("ventaCelular").value.trim();
  const i = parseInt(document.getElementById("ventaProducto").value);
  const precio = parseInt(document.getElementById("ventaPrecio").value);
  const cantidad = parseInt(document.getElementById("ventaCantidad").value);

  if (!cliente || !celular || isNaN(i) || i < 0 || isNaN(precio) || precio <= 0 || isNaN(cantidad) || cantidad <= 0) {
    showToast("Completa todos los campos correctamente.");
    return;
  }

  if (cantidad > inventario[i].cantidad) {
    showToast("Cantidad no disponible.");
    return;
  }

  const total = cantidad * precio;
  const fecha = new Date().toISOString();

  ventas.push({
    producto: inventario[i].nombre,
    foto: inventario[i].foto,
    cliente,
    celular,
    cantidad,
    total,
    fecha
  });

  clientes.push({
    nombre: cliente,
    celular,
    producto: inventario[i].nombre,
    foto: inventario[i].foto,
    fecha
  });

  inventario[i].cantidad -= cantidad;

  localStorage.setItem("inventario", JSON.stringify(inventario));
  localStorage.setItem("ventas", JSON.stringify(ventas));
  localStorage.setItem("clientes", JSON.stringify(clientes));

  mostrarInventario();
  mostrarClientes();
  actualizarDashboard();

  // Limpiar formulario
  agregarOtroProducto();
  document.getElementById("ventaCliente").value = "";
  document.getElementById("ventaCelular").value = "";
  document.getElementById("formNuevaVenta").style.display = "none";

  showToast("Venta registrada exitosamente.");
}

function mostrarClientes() {
  const tabla = document.getElementById("tablaClientes");
  tabla.innerHTML = "";
  clientes.forEach((c, i) => {
    tabla.innerHTML += `<tr>
      <td>${c.nombre}</td>
      <td>${c.celular}</td>
      <td>${c.producto}</td>
      <td><img src="${c.foto}" width="40" alt="${c.producto}"></td>
      <td>${new Date(c.fecha).toLocaleString()}</td>
      <td><button class="btn btn-eliminar btn-sm" onclick="eliminarCliente(${i})">Eliminar</button></td>
    </tr>`;
  });
}

function eliminarCliente(i) {
  if (confirm("¿Estás seguro de eliminar esta venta?")) {
    const venta = ventas[i];
    const idx = inventario.findIndex(p => p.nombre === venta.producto);
    if (idx >= 0) {
      inventario[idx].cantidad += venta.cantidad;
      localStorage.setItem("inventario", JSON.stringify(inventario));
      mostrarInventario();
    }
    ventas.splice(i, 1);
    clientes.splice(i, 1);
    localStorage.setItem("ventas", JSON.stringify(ventas));
    localStorage.setItem("clientes", JSON.stringify(clientes));
    mostrarClientes();
    actualizarDashboard();
    showToast("Venta eliminada.");
  }
}

// Dashboard
function actualizarDashboard() {
  const total = ventas.reduce((a, v) => a + v.total, 0);
  document.getElementById("totalVendido").innerText = "$" + total.toLocaleString();
  const comp = meta > 0 ? Math.round((total / meta) * 100) : 0;
  document.getElementById("cumplimiento").innerText = comp + "%";
  document.getElementById("faltante").innerText = "$" + Math.max(meta - total, 0).toLocaleString();
  actualizarGraficos();
  filtrarVentasEquipo();
}

function guardarMeta() {
  meta = parseInt(document.getElementById("metaInput").value) || 0;
  localStorage.setItem("meta", meta);
  actualizarDashboard();
  showToast("Meta guardada.");
}

// Exportaciones
function exportPDFInventario() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(12);
  doc.text("Inventario", 10, 10);
  let y = 20;
  inventario.forEach((p, i) => {
    if (y > 270) {
      doc.addPage();
      y = 20;
    }
    doc.text(`${p.nombre} | ${p.codigo} | Cantidad: ${p.cantidad}`, 10, y);
    y += 10;
  });
  doc.save("inventario.pdf");
  showToast("PDF generado.");
}

function exportarClientesExcel() {
  const ws = XLSX.utils.json_to_sheet(clientes.map(c => ({
    Nombre: c.nombre,
    Celular: c.celular,
    Producto: c.producto,
    Fecha: new Date(c.fecha).toLocaleString()
  })));
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Clientes");
  XLSX.writeFile(wb, "clientes.xlsx");
  showToast("Excel generado.");
}

function resetDashboard() {
  if (confirm("¿Desea reiniciar todo? Esto eliminará todos los datos.")) {
    inventario = [];
    clientes = [];
    ventas = [];
    meta = 0;
    localStorage.clear();
    mostrarInventario();
    mostrarClientes();
    actualizarDashboard();
    cargarProductosVenta();
    showToast("Dashboard reseteado.");
  }
}

// Gráficos
function actualizarGraficos() {
  // Ventas por Día
  const ventasPorDia = {};
  ventas.forEach(v => {
    const dia = new Date(v.fecha).toLocaleDateString();
    ventasPorDia[dia] = (ventasPorDia[dia] || 0) + v.total;
  });
  const labelsDia = Object.keys(ventasPorDia);
  const dataDia = Object.values(ventasPorDia);
  if (chartVentasDia) chartVentasDia.destroy();
  chartVentasDia = new Chart(document.getElementById("ventasDia"), {
    type: 'line',
    data: {
      labels: labelsDia,
      datasets: [{
        label: "Ventas por Día",
        data: dataDia,
        borderColor: '#00d9ff',
        backgroundColor: '#00d9ff44',
        fill: true,
        pointRadius: 5,
        pointHoverRadius: 8,
        tension: 0.4
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        tooltip: {
          backgroundColor: '#0a0f1c',
          titleColor: '#00d9ff',
          bodyColor: '#fff',
          borderColor: '#00d9ff',
          borderWidth: 1
        }
      },
      scales: {
        x: {
          grid: {
            color: '#00d9ff55'
          },
          ticks: {
            color: '#fff'
          }
        },
        y: {
          grid: {
            color: '#00d9ff55'
          },
          ticks: {
            color: '#fff'
          }
        }
      }
    }
  });

  // Ventas por Producto
  const ventasPorProducto = {};
  ventas.forEach(v => {
    ventasPorProducto[v.producto] = (ventasPorProducto[v.producto] || 0) + v.total;
  });
  const labelsProd = Object.keys(ventasPorProducto);
  const dataProd = Object.values(ventasPorProducto);
  if (chartVentasProducto) chartVentasProducto.destroy();
  chartVentasProducto = new Chart(document.getElementById("ventasProducto"), {
    type: 'bar',
    data: {
      labels: labelsProd,
      datasets: [{
        label: "Ventas por Producto",
        data: dataProd,
        backgroundColor: '#6f00ff',
        borderColor: '#00d9ff',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        tooltip: {
          backgroundColor: '#0a0f1c',
          titleColor: '#00d9ff',
          bodyColor: '#fff',
          borderColor: '#00d9ff',
          borderWidth: 1
        }
      },
      scales: {
        x: {
          grid: {
            color: '#00d9ff55'
          },
          ticks: {
            color: '#fff'
          }
        },
        y: {
          grid: {
            color: '#00d9ff55'
          },
          ticks: {
            color: '#fff'
          }
        }
      }
    }
  });

  // Cumplimiento
  const total = ventas.reduce((a, v) => a + v.total, 0);
  const comp = meta > 0 ? Math.round((total / meta) * 100) : 0;
  if (chartCumplimiento) chartCumplimiento.destroy();
  chartCumplimiento = new Chart(document.getElementById("cumplimientoChart"), {
    type: 'doughnut',
    data: {
      labels: ["Cumplimiento", "Faltante"],
      datasets: [{
        data: [comp, Math.max(100 - comp, 0)],
        backgroundColor: ['#00ff66', '#ff0033'],
        borderColor: '#00d9ff',
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          labels: {
            color: '#fff'
          }
        },
        tooltip: {
          backgroundColor: '#0a0f1c',
          titleColor: '#00d9ff',
          bodyColor: '#fff',
          borderColor: '#00d9ff',
          borderWidth: 1
        }
      }
    }
  });
}

function filtrarVentasEquipo() {
  const filtro = document.getElementById("filtroEquipo").value;
  const now = new Date();
  let filtered = ventas;

  if (filtro === "dia") {
    const today = now.toDateString();
    filtered = ventas.filter(v => new Date(v.fecha).toDateString() === today);
  } else if (filtro === "semana") {
    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
    filtered = ventas.filter(v => new Date(v.fecha) >= weekAgo);
  } else if (filtro === "mes") {
    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
    filtered = ventas.filter(v => new Date(v.fecha) >= monthStart);
  } else if (filtro === "anio") {
    const yearStart = new Date(now.getFullYear(), 0, 1);
    filtered = ventas.filter(v => new Date(v.fecha) >= yearStart);
  }

  const tabla = document.getElementById("tablaVentasEquipo").querySelector("tbody");
  tabla.innerHTML = "";
  const agrupado = {};
  filtered.forEach(v => {
    agrupado[v.producto] = (agrupado[v.producto] || 0) + v.cantidad;
  });

  Object.entries(agrupado).forEach(([prod, cant]) => {
    const item = inventario.find(p => p.nombre === prod);
    if (item) {
      tabla.innerHTML += `<tr>
        <td><img src="${item.foto}" width="40" alt="${prod}"></td>
        <td>${prod}</td>
        <td>${cant}</td>
      </tr>`;
    }
  });

  const labels = Object.keys(agrupado);
  const data = Object.values(agrupado);
  if (chartVentasEquipo) chartVentasEquipo.destroy();
  chartVentasEquipo = new Chart(document.getElementById("ventasEquipo"), {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Cantidad vendida',
        data: data,
        backgroundColor: '#00d9ff'
      }]
    },
    options: { responsive: true, maintainAspectRatio: false }
  });
}
</script>
</body>
</html>
